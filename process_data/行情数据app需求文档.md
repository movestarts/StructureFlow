# ğŸ› ï¸ é¡¹ç›®è®¾è®¡æ–‡æ¡£ï¼šUniData-Fetcher (é€šç”¨è¡Œæƒ…è·å–å™¨)

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

å¼€å‘ä¸€ä¸ªåŸºäº Python çš„è·¨å¹³å°åº”ç”¨ï¼ˆæ”¯æŒ **Windows** å’Œ **Android**ï¼‰ï¼Œç”¨äºä»å¼€æºæ•°æ®æºè·å–é‡‘èå¸‚åœºå†å²è¡Œæƒ…æ•°æ®ï¼ˆæœŸè´§ã€è‚¡ç¥¨ã€å¤–æ±‡ã€åŠ å¯†è´§å¸ï¼‰ï¼Œå¹¶æ¸…æ´—ä¸ºç‰¹å®šæ ¼å¼çš„ CSV æ–‡ä»¶ï¼Œä¾›ä¸‹æ¸¸å¤ç›˜è½¯ä»¶ä½¿ç”¨ã€‚

## 2. æŠ€æœ¯æ ˆ (Tech Stack)

- **UI æ¡†æ¶:** `Flet` (åŸºäº Flutter çš„ Python æ¡†æ¶ï¼Œç¡®ä¿ä¸€å¥—ä»£ç åŒæ—¶ç¼–è¯‘ä¸º Windows .exe å’Œ Android .apk)ã€‚
    
- **æ•°æ®å¤„ç†:** `Pandas` (æ•°æ®æ¸…æ´—ä¸æ ¼å¼åŒ–)ã€‚
    
- **æ•°æ®æº (å¼€æºåº“):**
    
    - **æœŸè´§ (CN):** `AkShare` (æ¥å£æ¨è: `futures_zh_daily_sina` æˆ– `futures_zh_spot`)ã€‚
        
    - **è‚¡ç¥¨ (CN/US):** `AkShare` (Aè‚¡), `yfinance` (ç¾è‚¡)ã€‚
        
    - **åŠ å¯†è´§å¸ (Crypto):** `ccxt` (æ”¯æŒ Binance, OKX ç­‰)ã€‚
        
    - **å¤–æ±‡ (Forex):** `yfinance` (ç¨³å®šä¸”å…è´¹)ã€‚
        

## 3. æ ¸å¿ƒéœ€æ±‚ï¼šç»Ÿä¸€è¾“å‡ºæ ¼å¼ (Strict Output Schema)

æ— è®ºæ•°æ®æºæ¥è‡ªå“ªé‡Œï¼Œæœ€ç»ˆå¯¼å‡ºçš„ CSV **å¿…é¡»**ä¸¥æ ¼éµå®ˆä»¥ä¸‹ç»“æ„å’Œåˆ—åã€‚

**ç›®æ ‡ CSV æ ·ä¾‹:**

ä»£ç æ®µ

```
datetime,open,high,low,close,volume,amount,position,symbol
2009/3/27 9:00:00,3550,3662,3550,3600,32014,1.15E+09,16558,RB0909
```

**å­—æ®µæ˜ å°„è§„èŒƒ:**

1. **datetime:** æ ¼å¼å¿…é¡»ä¸º `YYYY/M/D H:M:S` (ä¾‹å¦‚: `2024/2/15 15:00:00`)ã€‚
    
2. **open/high/low/close:** æ•°å€¼å‹ï¼Œä¿ç•™å¿…è¦å°æ•°ä½ã€‚
    
3. **volume:** æˆäº¤é‡ (Vol)ã€‚
    
4. **amount:** æˆäº¤é¢ (Turnover)ã€‚å¦‚æœæºæ•°æ®æ²¡æœ‰ï¼Œå¡« `0`ã€‚
    
5. **position:** æŒä»“é‡ (Open Interest)ã€‚å¦‚æœæºæ•°æ®æ²¡æœ‰ï¼ˆå¦‚è‚¡ç¥¨/å¤–æ±‡ï¼‰ï¼Œå¡« `0`ã€‚
    
6. **symbol:** å“ç§ä»£ç  (å¦‚ `RB2605`, `BTC/USDT`, `AAPL`)ã€‚
    

## 4. æ¨¡å—è¯¦ç»†è®¾è®¡ (Module Design)

### 4.1 UI äº¤äº’å±‚ (Flet Interface)

- **å¸ƒå±€:** é‡‡ç”¨ `ft.Tabs` åˆ†ä¸ºå››ä¸ªæ ‡ç­¾é¡µï¼š`[æœŸè´§]`, `[è‚¡ç¥¨]`, `[åŠ å¯†è´§å¸]`, `[å¤–æ±‡]`ã€‚
    
- **é€šç”¨æ§ä»¶:**
    
    - `TextField`: è¾“å…¥ä»£ç  (Symbol)ã€‚
        
    - `Dropdown`: é€‰æ‹©å‘¨æœŸ (æ—¥çº¿, 1å°æ—¶, 15åˆ†é’Ÿ)ã€‚
        
    - `DatePicker`: å¼€å§‹/ç»“æŸæ—¶é—´ã€‚
        
    - `ElevatedButton`: "è·å–å¹¶å¯¼å‡º (Fetch & Export)"ã€‚
        
    - `ProgressBar`: æ˜¾ç¤ºä¸‹è½½çŠ¶æ€ã€‚
        
    - `Text`: æ˜¾ç¤ºæ—¥å¿—ï¼ˆå¦‚ "æˆåŠŸå¯¼å‡ºè‡³ /Downloads/..."ï¼‰ã€‚
        

### 4.2 æ•°æ®è·å–å±‚ (Data Service)

#### A. æœŸè´§æ¨¡å— (Futures) - æ ¸å¿ƒ

- **åº“:** `AkShare`
    
- **é€»è¾‘:**
    
    - ç”¨æˆ·è¾“å…¥: `RB2405`
        
    - è°ƒç”¨ `ak.futures_zh_daily_sina(symbol="RB2405")`ã€‚
        
    - **å­—æ®µæ˜ å°„:**
        
        - `æ—¥æœŸ` -> `datetime`
            
        - `å¼€ç›˜` -> `open`, `æœ€é«˜` -> `high`, ...
            
        - `æŒä»“é‡` -> `position`
            
        - `åŠ¨æ€ç»“ç®—ä»·` -> (å¿½ç•¥æˆ–ç”¨äºæ ¡éªŒ)
            

#### B. è‚¡ç¥¨æ¨¡å— (Stocks)

- **åº“:** `AkShare` (Aè‚¡) / `yfinance` (ç¾è‚¡)
    
- **é€»è¾‘:**
    
    - Aè‚¡: `ak.stock_zh_a_hist(symbol="000001", ...)`
        
    - **å­—æ®µæ˜ å°„:** `æˆäº¤é¢` -> `amount`, `position` è®¾ä¸º 0ã€‚
        

#### C. åŠ å¯†è´§å¸æ¨¡å— (Crypto)

- **åº“:** `ccxt`
    
- **é€»è¾‘:**
    
    - åˆå§‹åŒ–: `exchange = ccxt.binance()`
        
    - è°ƒç”¨: `exchange.fetch_ohlcv('BTC/USDT', timeframe='1d')`
        
    - **æ³¨æ„:** `ccxt` è¿”å›çš„æ˜¯ List ç»“æ„ `[timestamp, open, high, low, close, volume]`ã€‚éœ€æ‰‹åŠ¨è½¬æ¢ä¸º DataFrameã€‚
        
    - **ç‰¹æ®Šå¤„ç†:** `amount` éœ€é€šè¿‡ `close * volume` ä¼°ç®—ï¼Œæˆ–è®¾ä¸º 0ï¼›`position` åœ¨ç°è´§ä¸­ä¸º 0ï¼Œåˆçº¦æ¥å£éœ€è°ƒ `fetch_open_interest` (å¯é€‰ï¼Œè‹¥éº»çƒ¦å¯å…ˆç½® 0)ã€‚
        

#### D. å¤–æ±‡æ¨¡å— (Forex)

- **åº“:** `yfinance`
    
- **é€»è¾‘:**
    
    - ç”¨æˆ·è¾“å…¥: `EURUSD=X`
        
    - è°ƒç”¨: `yf.download(...)`
        
    - **ç‰¹æ®Šå¤„ç†:** å¤–æ±‡é€šå¸¸æ²¡æœ‰ `volume` (æˆ–ä¸å‡†ç¡®) å’Œ `position`ï¼Œè¿™ä¸¤åˆ—å¡« 0ã€‚
        

### 4.3 å­˜å‚¨é€‚é…å±‚ (Storage Adapter)

- **Android:**
    
    - ä½¿ç”¨ `os.path.join('/storage/emulated/0/Download', 'FuturesReplayData')`ã€‚
        
    - éœ€åœ¨ Flet æ‰“åŒ…é…ç½®ä¸­ç”³è¯· `WRITE_EXTERNAL_STORAGE` æƒé™ã€‚
        
- **Windows:**
    
    - é»˜è®¤ä¿å­˜åˆ°ç”¨æˆ· `Downloads/FuturesReplayData` æ–‡ä»¶å¤¹ã€‚
        
- **æ–‡ä»¶åç”Ÿæˆ:** è‡ªåŠ¨å‘½åä¸º `{Symbol}_{Timeframe}_{Timestamp}.csv`ã€‚