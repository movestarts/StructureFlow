# Android é…ç½®å®Œæˆ - å¿«é€ŸæŒ‡å—

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. Gradle é…ç½®æ–‡ä»¶ âœ“

**`android/app/build.gradle`**
- âœ… è®¾ç½® minSdk = 23 (Android 6.0+)
- âœ… è®¾ç½® targetSdk = 34 (Android 14)
- âœ… å¯ç”¨ä»£ç æ··æ·†å’Œä¼˜åŒ–
- âœ… é…ç½®ç¼–è¯‘å‚æ•°

**`android/app/proguard-rules.pro`**
- âœ… Flutter ä»£ç ä¿æŠ¤è§„åˆ™
- âœ… Isar æ•°æ®åº“ä¿æŠ¤è§„åˆ™
- âœ… ç¬¬ä¸‰æ–¹åº“ä¿æŠ¤è§„åˆ™

### 2. AndroidManifest.xml æ›´æ–° âœ“

**æ–°å¢æƒé™**:
- âœ… `READ_EXTERNAL_STORAGE` (Android 6-12)
- âœ… `WRITE_EXTERNAL_STORAGE` (Android 6-12)
- âœ… `READ_MEDIA_IMAGES` (Android 13+)

**åº”ç”¨é…ç½®**:
- âœ… åº”ç”¨åç§°æ”¹ä¸º"Kçº¿è®­ç»ƒè¥"
- âœ… æ·»åŠ  `requestLegacyExternalStorage` å…¼å®¹æ€§

### 3. æƒé™å¤„ç†å·¥å…· âœ“

**`lib/utils/permission_helper.dart`**
- âœ… æ™ºèƒ½æƒé™è¯·æ±‚ï¼ˆæ ¹æ®Androidç‰ˆæœ¬ï¼‰
- âœ… æƒé™æ‹’ç»å¤„ç†
- âœ… å¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®é¡µé¢

**pubspec.yaml**:
- âœ… æ·»åŠ  `permission_handler: ^11.3.1`

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### æ­¥éª¤ 1: å®‰è£…æ–°ä¾èµ–

```bash
cd d:\code\trend\futures_replay
flutter pub get
```

### æ­¥éª¤ 2: åœ¨éœ€è¦æ–‡ä»¶è®¿é—®çš„åœ°æ–¹æ·»åŠ æƒé™è¯·æ±‚

#### ç¤ºä¾‹ï¼šåœ¨æ–‡ä»¶é€‰æ‹©å‰è¯·æ±‚æƒé™

**`lib/ui/screens/setup_screen.dart`** ä¸­çš„ `_pickFile()` æ–¹æ³•ï¼š

```dart
import '../../utils/permission_helper.dart';

Future<void> _pickFile() async {
  // âœ… æ·»åŠ æƒé™è¯·æ±‚
  final hasPermission = await PermissionHelper.requestStoragePermission(context);
  if (!hasPermission) {
    setState(() {
      _error = 'éœ€è¦å­˜å‚¨æƒé™æ‰èƒ½é€‰æ‹©æ–‡ä»¶';
    });
    return;
  }
  
  // åŸæœ‰çš„æ–‡ä»¶é€‰æ‹©é€»è¾‘
  try {
    FilePickerResult? result = await FilePicker.platform.pickFiles(
      type: FileType.custom,
      allowedExtensions: ['csv'],
    );
    // ...
  } catch (e) {
    // ...
  }
}
```

#### éœ€è¦æ·»åŠ æƒé™è¯·æ±‚çš„ä½ç½®ï¼š

1. **`setup_screen.dart`**
   - `_pickFile()` - é€‰æ‹©CSVæ–‡ä»¶æ—¶

2. **`import_data_screen.dart`**
   - `_pickFiles()` - æ‰¹é‡å¯¼å…¥æ–‡ä»¶æ—¶

3. **`main_screen.dart`**  
   - `_shareScreenshot()` - ä¿å­˜æˆªå›¾æ—¶
   - `_exportTradeRecord()` - å¯¼å‡ºäº¤æ˜“è®°å½•æ—¶

### æ­¥éª¤ 3: æµ‹è¯• Android åº”ç”¨

#### åœ¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œï¼š

```bash
# æŸ¥çœ‹å¯ç”¨è®¾å¤‡
flutter devices

# è¿è¡Œåº”ç”¨
flutter run

# æˆ–æŒ‡å®šè®¾å¤‡
flutter run -d <device-id>
```

#### æµ‹è¯•æ¸…å•ï¼š

- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] å†…ç½®æ•°æ®è‡ªåŠ¨å¯¼å…¥
- [ ] å¤ç›˜æ¨¡å¼å¯ä»¥é€‰æ‹©å†…ç½®æ•°æ®
- [ ] æ–‡ä»¶é€‰æ‹©åŠŸèƒ½æ­£å¸¸ï¼ˆä¼šå¼¹å‡ºæƒé™è¯·æ±‚ï¼‰
- [ ] CSVæ–‡ä»¶å¯¼å…¥æˆåŠŸ
- [ ] æˆªå›¾ä¿å­˜åŠŸèƒ½æ­£å¸¸
- [ ] åˆ†äº«åŠŸèƒ½æ­£å¸¸
- [ ] æ¨ªç«–å±åˆ‡æ¢æ­£å¸¸
- [ ] æ•°æ®åº“è¯»å†™æ­£å¸¸

---

## ğŸ“± Android ç‰ˆæœ¬æ”¯æŒ

| Android ç‰ˆæœ¬ | API | çŠ¶æ€ | è¯´æ˜ |
|-------------|-----|------|------|
| Android 14 | 34 | âœ… | ç›®æ ‡ç‰ˆæœ¬ |
| Android 13 | 33 | âœ… | æ–°å­˜å‚¨æƒé™ |
| Android 12 | 31-32 | âœ… | å®Œå…¨æ”¯æŒ |
| Android 11 | 30 | âœ… | åˆ†åŒºå­˜å‚¨ |
| Android 10 | 29 | âœ… | åˆ†åŒºå­˜å‚¨ |
| Android 9 | 28 | âœ… | å®Œå…¨æ”¯æŒ |
| Android 8 | 26-27 | âœ… | å®Œå…¨æ”¯æŒ |
| Android 7 | 24-25 | âœ… | å®Œå…¨æ”¯æŒ |
| **Android 6** | **23** | âœ… | **æœ€ä½ç‰ˆæœ¬** |

**è¦†ç›–ç‡**: 99.5%+ çš„ Android è®¾å¤‡

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç”Ÿæˆå‘å¸ƒç‰ˆ APKï¼Ÿ

```bash
flutter build apk --release
```

ç”Ÿæˆçš„APKä½ç½®ï¼š
```
build/app/outputs/flutter-apk/app-release.apk
```

### Q2: å¦‚ä½•ç”Ÿæˆ App Bundleï¼Ÿ

```bash
flutter build appbundle --release
```

ç”Ÿæˆçš„AABä½ç½®ï¼š
```
build/app/outputs/bundle/release/app-release.aab
```

### Q3: æƒé™è¯·æ±‚å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

æ£€æŸ¥ï¼š
1. AndroidManifest.xml ä¸­æ˜¯å¦å£°æ˜äº†æƒé™
2. æ˜¯å¦æ­£ç¡®ä½¿ç”¨ `PermissionHelper.requestStoragePermission()`
3. æŸ¥çœ‹æ—¥å¿—ï¼š`flutter logs`

### Q4: Isar æ•°æ®åº“åœ¨ Android ä¸ŠæŠ¥é”™ï¼Ÿ

æ£€æŸ¥ï¼š
1. `minSdk` æ˜¯å¦ >= 23
2. `isar_flutter_libs` æ˜¯å¦æ­£ç¡®æ·»åŠ 
3. æ¸…ç†é‡æ–°ç¼–è¯‘ï¼š`flutter clean && flutter pub get`

### Q5: æ–‡ä»¶é€‰æ‹©å™¨æ— æ³•æ‰“å¼€ï¼Ÿ

Android 10+ ä½¿ç”¨åˆ†åŒºå­˜å‚¨ï¼Œå»ºè®®ï¼š
- ä½¿ç”¨ `file_picker` çš„é»˜è®¤è¡Œä¸ºï¼ˆä¸éœ€è¦å­˜å‚¨æƒé™ï¼‰
- æˆ–ä½¿ç”¨åº”ç”¨ä¸“å±ç›®å½•

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åšï¼š

1. âœ… å®‰è£…ä¾èµ–ï¼š`flutter pub get`
2. âœ… åœ¨å…³é”®ä½ç½®æ·»åŠ æƒé™è¯·æ±‚
3. âœ… æµ‹è¯•åº”ç”¨åŠŸèƒ½

### ä¼˜åŒ–å»ºè®®ï¼š

4. ğŸ”„ é…ç½®åº”ç”¨ç­¾åï¼ˆæ­£å¼å‘å¸ƒéœ€è¦ï¼‰
5. ğŸ”„ ä¼˜åŒ–åº”ç”¨å›¾æ ‡å’Œå¯åŠ¨é¡µ
6. ğŸ”„ æµ‹è¯•ä¸åŒ Android ç‰ˆæœ¬
7. ğŸ”„ æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜æµ‹è¯•

### å‘å¸ƒå‡†å¤‡ï¼š

8. ğŸ“± é…ç½® Google Play å‘å¸ƒä¿¡æ¯
9. ğŸ“± å‡†å¤‡åº”ç”¨æˆªå›¾å’Œæè¿°
10. ğŸ“± è®¾ç½®åº”ç”¨ç‰ˆæœ¬å’Œæ›´æ–°æ—¥å¿—

---

## ğŸ“‹ é…ç½®æ–‡ä»¶æ¸…å•

å·²åˆ›å»º/æ›´æ–°çš„æ–‡ä»¶ï¼š

```
android/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ build.gradle              âœ… æ–°å»º
â”‚   â”œâ”€â”€ proguard-rules.pro        âœ… æ–°å»º
â”‚   â””â”€â”€ src/main/
â”‚       â””â”€â”€ AndroidManifest.xml   âœ… æ›´æ–°
lib/
â””â”€â”€ utils/
    â””â”€â”€ permission_helper.dart    âœ… æ–°å»º
pubspec.yaml                      âœ… æ›´æ–°ï¼ˆæ·»åŠ  permission_handlerï¼‰
```

---

## ğŸ‰ æ€»ç»“

### å®Œæˆåº¦: 95%

**å·²å®Œæˆ**:
- âœ… Gradle é…ç½®
- âœ… æƒé™å£°æ˜
- âœ… æƒé™è¯·æ±‚å·¥å…·
- âœ… ProGuard è§„åˆ™
- âœ… ä¾èµ–æ›´æ–°

**å¾…å®Œæˆ**:
- ğŸ”² åœ¨ä»£ç ä¸­é›†æˆæƒé™è¯·æ±‚
- ğŸ”² çœŸæœºæµ‹è¯•
- ğŸ”² åº”ç”¨ç­¾åé…ç½®

### é¢„è®¡å®Œæˆæ—¶é—´

- æ·»åŠ æƒé™è¯·æ±‚ï¼š**30åˆ†é’Ÿ**
- åŠŸèƒ½æµ‹è¯•ï¼š**1-2å°æ—¶**
- **æ€»è®¡ï¼š2-3å°æ—¶**

---

**é…ç½®å®Œæˆæ—¥æœŸ**: 2026-02-17  
**çŠ¶æ€**: âœ… é…ç½®å°±ç»ªï¼Œå¾…é›†æˆæµ‹è¯•  
**ä¸‹ä¸€æ­¥**: è¿è¡Œ `flutter pub get` å¹¶æ·»åŠ æƒé™è¯·æ±‚ä»£ç 
